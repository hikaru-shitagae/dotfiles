# Neovim 完全ガイド & チートシート

## 目次
1. [Neovimの基本](#neovimの基本)
2. [モードの切り替え](#モードの切り替え)
3. [基本的な移動](#基本的な移動)
4. [編集操作](#編集操作)
5. [ファイル操作](#ファイル操作)
6. [検索と置換](#検索と置換)
7. [ウィンドウ操作](#ウィンドウ操作)
8. [プラグイン機能](#プラグイン機能)
9. [LSP機能](#lsp機能)
10. [Git操作](#git操作)

---

## Neovimの基本

### 起動と終了
| コマンド | 説明 |
|---------|------|
| `nvim ファイル名` | ファイルを開く |
| `:q` | 終了 |
| `:q!` | 保存せずに終了 |
| `:wq` または `:x` | 保存して終了 |
| `:w` | 保存 |
| `:w ファイル名` | 名前をつけて保存 |
| `ZZ` | 保存して終了（ノーマルモード） |
| `ZQ` | 保存せずに終了（ノーマルモード） |

### Leader Key
- **Leader Key**: `Space`（スペースキー）
- 多くのカスタムキーバインドはLeader + 他のキーで実行します

---

## モードの切り替え

Neovimには複数のモードがあります：

| モード | 説明 | 入り方 | 抜け方 |
|--------|------|--------|--------|
| **ノーマルモード** | コマンド実行、移動 | 起動時のデフォルト | - |
| **インサートモード** | テキスト入力 | `i`, `a`, `o` など | `Esc` または `Ctrl+[` |
| **ビジュアルモード** | テキスト選択 | `v`, `V`, `Ctrl+v` | `Esc` |
| **コマンドラインモード** | Exコマンド実行 | `:` | `Esc` または実行 |

### インサートモードへの入り方
| キー | 説明 |
|------|------|
| `i` | カーソル位置で挿入 |
| `I` | 行頭で挿入 |
| `a` | カーソルの後ろで挿入 |
| `A` | 行末で挿入 |
| `o` | 下に新しい行を作成して挿入 |
| `O` | 上に新しい行を作成して挿入 |

---

## 基本的な移動

### 文字単位の移動
| キー | 説明 |
|------|------|
| `h` | 左へ |
| `j` | 下へ |
| `k` | 上へ |
| `l` | 右へ |
| `w` | 次の単語の先頭へ |
| `b` | 前の単語の先頭へ |
| `e` | 単語の末尾へ |

### 行内の移動
| キー | 説明 |
|------|------|
| `0` | 行頭へ |
| `^` | 行の最初の非空白文字へ |
| `$` | 行末へ |
| `gg` | ファイルの先頭へ |
| `G` | ファイルの末尾へ |
| `{行番号}G` | 指定行へジャンプ（例: `10G`） |

### 画面単位の移動
| キー | 説明 |
|------|------|
| `Ctrl+u` | 半画面上へスクロール |
| `Ctrl+d` | 半画面下へスクロール |
| `Ctrl+b` | 1画面上へスクロール |
| `Ctrl+f` | 1画面下へスクロール |
| `zz` | カーソル行を画面中央に |
| `zt` | カーソル行を画面上部に |
| `zb` | カーソル行を画面下部に |

---

## 編集操作

### 削除
| キー | 説明 |
|------|------|
| `x` | カーソル位置の1文字を削除 |
| `dd` | 行全体を削除 |
| `dw` | 単語を削除 |
| `d$` または `D` | カーソルから行末まで削除 |
| `d0` | カーソルから行頭まで削除 |
| `{数値}dd` | 指定行数を削除（例: `3dd`） |

### コピー（ヤンク）とペースト
| キー | 説明 |
|------|------|
| `yy` | 行全体をコピー |
| `yw` | 単語をコピー |
| `y$` | カーソルから行末までコピー |
| `p` | カーソルの後ろにペースト |
| `P` | カーソルの前にペースト |
| `{数値}yy` | 指定行数をコピー（例: `3yy`） |

### アンドゥとリドゥ
| キー | 説明 |
|------|------|
| `u` | アンドゥ（元に戻す） |
| `Ctrl+r` | リドゥ（やり直し） |

### その他の編集操作
| キー | 説明 |
|------|------|
| `r{文字}` | カーソル位置の1文字を置換 |
| `R` | 上書きモード |
| `J` | 次の行を現在の行に結合 |
| `~` | 大文字小文字を切り替え |
| `.` | 直前の操作を繰り返し |

---

## ファイル操作

### 保存と開く
| コマンド | 説明 |
|---------|------|
| `:w` | 保存 |
| `:w ファイル名` | 名前をつけて保存 |
| `:e ファイル名` | ファイルを開く |
| `:e!` | 変更を破棄して再読み込み |

### バッファ操作
| キー | 説明 |
|------|------|
| `Ctrl+h` | 前のバッファへ |
| `Ctrl+l` | 次のバッファへ |
| `Space+x` | 現在のバッファを閉じる |
| `:bn` | 次のバッファへ（コマンド） |
| `:bp` | 前のバッファへ（コマンド） |
| `:bd` | 現在のバッファを閉じる（コマンド） |

---

## 検索と置換

### 検索
| キー | 説明 |
|------|------|
| `/検索語` | 前方検索 |
| `?検索語` | 後方検索 |
| `n` | 次の検索結果へ（nvim-hlslensで強化済み） |
| `N` | 前の検索結果へ（nvim-hlslensで強化済み） |
| `*` | カーソル下の単語を前方検索 |
| `#` | カーソル下の単語を後方検索 |
| `Space+l` | 検索ハイライトをクリア |

### 置換
| コマンド | 説明 |
|---------|------|
| `:s/検索/置換/` | 現在行の最初の一致を置換 |
| `:s/検索/置換/g` | 現在行のすべての一致を置換 |
| `:%s/検索/置換/g` | ファイル全体のすべての一致を置換 |
| `:%s/検索/置換/gc` | ファイル全体で確認しながら置換 |

---

## ウィンドウ操作

### ウィンドウ分割
| キー | 説明 |
|------|------|
| `:split` または `:sp` | 水平分割 |
| `:vsplit` または `:vs` | 垂直分割 |
| `Ctrl+w s` | 水平分割 |
| `Ctrl+w v` | 垂直分割 |

### ウィンドウ間の移動
| キー | 説明 |
|------|------|
| `Ctrl+w h` | 左のウィンドウへ |
| `Ctrl+w j` | 下のウィンドウへ |
| `Ctrl+w k` | 上のウィンドウへ |
| `Ctrl+w l` | 右のウィンドウへ |
| `Ctrl+w w` | 次のウィンドウへ |
| `Ctrl+w q` | ウィンドウを閉じる |

---

## プラグイン機能

### ファイルツリー（nvim-tree）
| キー | 説明 |
|------|------|
| `Ctrl+n` | ファイルツリーの表示/非表示 |
| `Ctrl+m` | ファイルツリーにフォーカス |

**ファイルツリー内での操作**
| キー | 説明 |
|------|------|
| `Enter` | ファイルを開く/ディレクトリを展開 |
| `o` | ファイルを開く/ディレクトリを展開 |
| `a` | 新しいファイル/ディレクトリを作成 |
| `d` | 削除 |
| `r` | リネーム |
| `x` | カット |
| `c` | コピー |
| `p` | ペースト |
| `R` | ツリーをリフレッシュ |
| `?` | ヘルプを表示 |

### ファジーファインダー（Telescope）
| キー | 説明 |
|------|------|
| `Space ff` | ファイル検索 |
| `Space fg` | grep検索（ファイル内容を検索） |
| `Space fh` | ヘルプタグ検索 |

**Telescope内での操作**
| キー | 説明 |
|------|------|
| `Ctrl+n` / `Ctrl+p` | 次/前の候補 |
| `Ctrl+c` | キャンセル |
| `Enter` | 選択 |
| `Ctrl+x` | 水平分割で開く |
| `Ctrl+v` | 垂直分割で開く |

### バッファライン（bufferline）
画面上部にタブのように表示されます

**キーバインド**
| キー | 説明 |
|------|------|
| `Ctrl+h` | 前のバッファへ移動 |
| `Ctrl+l` | 次のバッファへ移動 |
| `Space+x` | 現在のバッファを閉じる |

**追加コマンド**
| コマンド | 説明 |
|---------|------|
| `:BufferLineCycleNext` | 次のバッファへ |
| `:BufferLineCyclePrev` | 前のバッファへ |
| `:BufferLinePickClose` | バッファを選択して閉じる |

### コメント（Comment.nvim）
| キー | 説明 |
|------|------|
| `gcc` | 現在行をコメントアウト/解除 |
| `gc{移動}` | 移動範囲をコメントアウト（例: `gcap` = 段落） |
| `gbc` | 現在行をブロックコメント |

**ビジュアルモードで選択後**
| キー | 説明 |
|------|------|
| `gc` | 選択範囲をコメントアウト/解除 |
| `gb` | 選択範囲をブロックコメント |

### 自動保存（auto-save）
- **InsertLeaveとTextChanged時に自動保存**
- 手動で無効化: `:ASToggle`

### インデント表示（indent-blankline）
- インデントガイドが自動的に表示されます
- 現在のスコープがハイライトされます

### 自動ペア（nvim-autopairs）
- `(`, `{`, `[`, `"`, `'` などを入力すると自動的にペアが挿入されます

---

## LSP機能

### コード移動
| キー | 説明 |
|------|------|
| `gd` | 定義へジャンプ |
| `gD` | 宣言へジャンプ |
| `gr` | 参照を表示 |
| `gi` | 実装へジャンプ |
| `K` | ホバー情報を表示 |
| `Ctrl+k` | シグネチャヘルプを表示 |

### コード編集
| キー | 説明 |
|------|------|
| `Space rn` | リネーム（変数名/関数名の変更） |
| `Space ca` | コードアクション（クイックフィックス） |
| `Space f` | コードフォーマット |

### 診断（エラー・警告）
| キー | 説明 |
|------|------|
| `[d` | 前の診断へ |
| `]d` | 次の診断へ |
| `Space e` | 診断の詳細を表示 |
| `Space q` | 診断一覧を表示 |

### LSPコマンド
| コマンド | 説明 |
|---------|------|
| `:LspInfo` | LSPの状態を表示 |
| `:Mason` | LSPサーバーの管理画面を開く |

### 補完（nvim-cmp）
**インサートモード中**
| キー | 説明 |
|------|------|
| `Tab` | 次の補完候補 |
| `Shift+Tab` | 前の補完候補 |
| `Enter` | 補完を確定 |
| `Ctrl+Space` | 補完を手動で表示 |
| `Ctrl+e` | 補完をキャンセル |

---

## Git操作

### Gitsigns（行ごとの差分表示）
- 左側に記号が表示されます：
  - `┃` - 追加/変更された行
  - `_` - 削除された行
  - `┆` - 追跡されていないファイル

### Gitコマンド
| コマンド | 説明 |
|---------|------|
| `:Gitsigns toggle_signs` | Git記号の表示切り替え |
| `:Gitsigns toggle_current_line_blame` | blame情報の表示切り替え |
| `:Gitsigns preview_hunk` | 変更箇所のプレビュー |

---

## カラースキーム（tokyonight）

現在のカラースキーム: **tokyonight-night**

### カラースキームの変更
```vim
:colorscheme tokyonight-night   " デフォルトダーク
:colorscheme tokyonight-storm   " 明るめダーク
:colorscheme tokyonight-moon    " 青みダーク
:colorscheme tokyonight-day     " ライト
```

---

## 便利なTips

### 行番号の表示/非表示
```vim
:set number          " 行番号を表示
:set nonumber        " 行番号を非表示
:set relativenumber  " 相対行番号を表示
```

### プラグイン管理
```vim
:Lazy               " Lazy.nvimのUIを開く
:Lazy update        " プラグインを更新
:Lazy sync          " プラグインを同期
:Lazy clean         " 不要なプラグインを削除
```

### ヘルプの見方
```vim
:help {キーワード}   " ヘルプを検索
:help nvim-tree     " プラグインのヘルプ
:help lsp           " LSPのヘルプ
```

### 設定ファイルの場所
- メイン設定: `~/.config/nvim/init.lua`
- プラグイン設定: `~/.config/nvim/lua/plugins/*.lua`

---

## トラブルシューティング

### よくある問題

1. **プラグインが動かない**
   ```vim
   :Lazy sync
   ```
   その後、Neovimを再起動

2. **LSPが動かない**
   ```vim
   :LspInfo      " LSPの状態確認
   :Mason        " LSPサーバーがインストールされているか確認
   ```

3. **補完が表示されない**
   - ファイルタイプが正しく認識されているか確認
   - LSPサーバーが起動しているか`:LspInfo`で確認

4. **色が正しく表示されない**
   ```vim
   :set termguicolors  " True colorを有効化
   ```

5. **設定変更後に反映されない**
   - Neovimを再起動
   - または`:source ~/.config/nvim/init.lua`

---

## クイックリファレンス

### よく使うコマンドTop 10
1. `i` - インサートモード
2. `Esc` - ノーマルモードに戻る
3. `:w` - 保存
4. `:q` - 終了
5. `dd` - 行削除
6. `yy` - 行コピー
7. `p` - ペースト
8. `u` - アンドゥ
9. `/検索語` - 検索
10. `gd` - 定義へジャンプ（LSP）

### よく使うプラグイン機能Top 7
1. `Ctrl+n` - ファイルツリー表示
2. `Space ff` - ファイル検索
3. `Space fg` - grep検索
4. `Ctrl+h` / `Ctrl+l` - バッファ移動
5. `Space+x` - バッファを閉じる
6. `gcc` - コメントアウト
7. `Space rn` - リネーム

---

## さらに学ぶには

- `:Tutor` - Neovimの対話式チュートリアル
- `:help` - ヘルプシステム
- `:help user-manual` - ユーザーマニュアル

---

**このチートシートを印刷またはブックマークして、いつでも参照できるようにしましょう！**
